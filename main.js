/*
@title: Space Invaders
@author: 
@tags: []
@addedOn: 2024-00-00
*/

const player = "p"
const Mob1 = "1"
const Mob2 = "2"
const Boss = "b"
const Background = "B"
const PlayerBullet = "P"
const AlienBullet = "A"
let MovingAliensLoop;


setLegend(
  [player, bitmap`
.......44.......
.......44.......
.......44.......
.......44.......
.......44.......
4444444444444444
4444444444444444
4444444444444444
................
................
................
................
................
................
................
................` ],
  [Mob1, bitmap`
................
................
................
.....222222.....
.....23..32.....
.....2....2.....
.....222222.....
....22422422....
....2.4..4.2....
..222......222..
..2..........2..
..2..........2..
..2..........2..
................
................
................`],
  [Mob2, bitmap`
................
........2.......
........2.......
........2.......
........2.......
.....3322233....
.....3322233....
2222222222222222
.....2222222....
.....2222222....
.....2222222....
........2.......
........2.......
........2.......
........2.......
................`],
  [Boss,bitmap`
................
.....333333.....
....33333333....
...3333333333...
..333333333333..
.33333333333333.
3333333333333333
3333333333333333
.33..........33.
.33..........33.
................
................
................
................
................
................`],
  [PlayerBullet, bitmap`
................
................
................
................
................
.......4........
.......4........
.......4........
.......4........
.......4........
.......4........
................
................
................
................
................`],
  [AlienBullet,bitmap`
................
................
................
................
................
.......3........
.......3........
.......3........
.......3........
.......3........
.......3........
.......3........
................
................
................
................`],
  [Background, bitmap`
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000`]
)

setBackground(Background)

// setSolids([player,Mob1])

let Stage = 0
const Stages = [
  map`
......
......
......
......
......
......
......
......
......
......`,
  map`
......
..b...
222222
111111
111111
......
......
......
......
..p...`
]

setMap(Stages[Stage])
addText("Space Invaders", options = { x:3, y:5, color: color`2` })
addText("Press i to Play", options = { x:3, y:7, color: color`2` })
setPushables({
  [ player ]: []
})

function PlayerShoot() {
  addSprite(getFirst(player).x,getFirst(player).y,PlayerBullet)
}
function Move_Mob1() {
  for (let i = 0; i < getAll(Mob1).length; i++) {
    alien = getAll(Mob1)[i]
    alien.y += 1
  }
}
function Move_Mob2() {
  for (let i = 0; i < getAll(Mob2).length; i++) {
    alien = getAll(Mob2)[i]
    alien.y += 1
  }
}

function Mob1Shoot(AlienIndex) {
  addSprite(getAll(Mob1)[AlienIndex].x,getAll(Mob1)[AlienIndex].y,AlienBullet)
}
function Mob2Shoot(AlienIndex) {
  addSprite(getAll(Mob2)[AlienIndex].x,getAll(Mob2)[AlienIndex].y,AlienBullet)
}

function AlienBulletsMove(speed) {
  for (let i = 0; i < getAll(AlienBullet).length; i++) {
    getAll(AlienBullet)[i].y += speed
    if (getAll(AlienBullet)[i].y >= 9){
      getAll(AlienBullet)[i].remove()
    }
}}

function PlayerBulletsMove(speed) {
  for (let i = 0; i < getAll(PlayerBullet).length; i++) {
    getAll(PlayerBullet)[i].y -= speed
    if (getAll(PlayerBullet)[i].y == 1){
      getAll(PlayerBullet)[i].remove()
    }
    Collision()
}}

function Main_Loop(time) {
  clearInterval(MovingAliensLoop);
  MovingAliensLoop = setInterval(() => {
    Move_Mob1();
    Move_Mob2();
  }, time);
  setInterval(() => {
    Mob1Shoot(Math.floor(Math.random() * getAll(Mob1).length));
    Mob2Shoot(Math.floor(Math.random() * getAll(Mob2).length));
  }, 1000);
  setInterval(() => {
    AlienBulletsMove(1);
    PlayerBulletsMove(2);
  },100)
};

function StageChange(Index){
  Stage = Index
  setMap(Stages[Stage])
}

function Collision(){
  if (tilesWith(PlayerBullet,Mob1).length > 0){
    tilesWith(PlayerBullet,Mob1)[0][0].remove()
    tilesWith(PlayerBullet,Mob1)[0][0].remove()
  }
}



onInput("i", () => {
  StageChange(1)
  clearText()
  onInput("w", () => {
    PlayerShoot()
})
  onInput("a", () => {
  getFirst(player).x -= 1
})
  onInput("d", () => {
  getFirst(player).x += 1
})
  Main_Loop(10000)
})




afterInput(() => {
  
})